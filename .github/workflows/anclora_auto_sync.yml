name: âš“ Anclora | Auto Sync Environments

on:
  push:
    branches:
      - development
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: ðŸ”¹ Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ“¥ Ensure script exists
        run: |
          if [ ! -f "scripts/anclora_sync_envs.ps1" ]; then
            mkdir -p scripts
            curl -L -o scripts/anclora_sync_envs.ps1 \
              https://raw.githubusercontent.com/ToniIAPro73/v0-landing-page-real-state/main/scripts/anclora_sync_envs.ps1
          fi

      - name: ðŸ”„ Run sync (Dev â†’ Main â†’ Preview â†’ Production)
        shell: pwsh
        run: ./scripts/anclora_sync_envs.ps1 -Mode FullSync

      - name: ðŸ§¾ Generate sync summary
        run: |
          echo "ðŸ§­ Sync run on $(date)" > sync_summary.txt
          git log -5 --oneline >> sync_summary.txt
          cat sync_summary.txt

      - name: ðŸ“¤ Upload summary
        uses: actions/upload-artifact@v4
        with:
          name: sync_summary
          path: sync_summary.txt
